AUI.add("aui-autocomplete",function(M){var w=M.Lang,V=w.isArray,J=w.isString,n=w.isNull,O=w.isFunction,v=M.ClassNameManager.getClassName,j="alert",h="content",p="helper",c="icon",t="item",k="list",R="loading",f="autocomplete",q="reset",r="results",a="selected",S="circle-triangle-b",i=j,D=R,C=v(f,a),H=v(f,k,t),o=v(p,q),B=v(f,r),U=v(f,r,h),Q=8,m=9,d=13,K=16,E=17,F=18,P=20,e=27,I=33,L=35,Y=36,l=38,X=40,W=39,T=37,g=44,u=44,G=229,Z={node:null,points:["tl","bl"]},s="boundingBox",b="contentBox";var N=function(){N.superclass.constructor.apply(this,arguments);};N.NAME=f;N.ATTRS={alwaysShowContainer:{value:false},autoHighlight:{value:true},applyLocalFilter:{value:null},button:{value:true},dataSource:{value:null},dataSourceType:{value:null},delimChar:{value:null,setter:function(A){if(J(A)&&(A.length>0)){A=[A];}else{if(!V(A)){A=M.Attribute.INVALID_VALUE;}}return A;}},forceSelection:{value:false},input:{value:null},matchKey:{value:0},maxResultsDisplayed:{value:10},minQueryLength:{value:1},queryDelay:{value:0.2,getter:function(A){return A*1000;}},queryInterval:{value:0.5,getter:function(A){return A*1000;}},queryMatchCase:{value:false},queryMatchContains:{value:false},queryQuestionMark:{value:true},schema:{value:null},schemaType:{value:"",validator:J},suppressInputUpdate:{value:false},typeAhead:{value:false},typeAheadDelay:{value:0.2,getter:function(A){return A*1000;}},uniqueName:{value:null}};M.extend(N,M.Component,{initializer:function(x){var A=this;A._overlayAlign=M.mix({},Z);A._createDataSource();},renderUI:function(){var A=this;A._renderInput();A._renderOverlay();},bindUI:function(){var A=this;var x=A.button;var y=A.inputNode;A.dataSource.on("request",M.bind(x.set,x,c,D));y.on("blur",A._onTextboxBlur,A);y.on("focus",A._onTextboxFocus,A);y.on("keydown",A._onTextboxKeyDown,A);y.on("keypress",A._onTextboxKeyPress,A);y.on("keyup",A._onTextboxKeyUp,A);var z=A.overlay.get(s);z.on("click",A._onContainerClick,A);z.on("mouseout",A._onContainerMouseout,A);z.on("mouseover",A._onContainerMouseover,A);z.on("scroll",A._onContainerScroll,A);A.publish("containerCollapse");A.publish("containerExpand");A.publish("containerPopulate");A.publish("dataError");A.publish("dataRequest");A.publish("dataReturn");A.publish("itemArrowFrom");A.publish("itemArrowTo");A.publish("itemMouseOut");A.publish("itemMouseOver");A.publish("itemSelect");A.publish("selectionEnforce");A.publish("textboxBlur");A.publish("textboxChange");A.publish("textboxFocus");A.publish("textboxKey");A.publish("typeAhead");A.publish("unmatchedItemSelect");A.overlay.on("visibleChange",A._realignContainer,A);},syncUI:function(){var A=this;A.inputNode.setAttribute("autocomplete","off");},doBeforeExpandContainer:function(){return true;},doBeforeLoadData:function(A){return true;},filterResults:function(AH){var AN=this;var y=AH.callback;var z=AH.request;var x=AH.response;if(y&&y.argument&&y.argument.query){z=y.argument.query;}if(z){var AM=AN.dataSource;var AJ=x.results;var A=[];var AB=false;var AA=AN.get("matchKey");var AK=AN.get("queryMatchCase");var AF=AN.get("queryMatchContains");var AE=(z=="*");var AG=AN.get("schema.resultFields");for(var AI=AJ.length-1;AI>=0;AI--){var AD=AJ[AI];var AL=null;if(J(AD)){AL=AD;}else{if(V(AD)){AL=AD[0];}else{if(AG){AL=AD[AA||AG[0]];}}}if(J(AL)){var AC=-1;if(AK){AC=AL.indexOf(decodeURIComponent(z));}else{AC=AL.toLowerCase().indexOf(decodeURIComponent(z).toLowerCase());}if((AE)||(!AF&&(AC===0))||(AF&&(AC>-1))){A.unshift(AD);}}}x.results=A;}return x;},formatResult:function(x,y,A){return A||"";},generateRequest:function(A){return{request:A};},handleResponse:function(y){var x=this;x._populateList(y);var A=S;if(y.error){A=i;}x.button.set(c,A);},sendQuery:function(x){var A=this;A.set("focused",null);var y=x;if(A.get("delimChar")){x=A.inputNode.get("value")+x;}A._sendQuery(y);},_clearInterval:function(){var A=this;if(A._queryIntervalId){clearInterval(A._queryIntervalId);A._queryIntervalId=null;}},_clearSelection:function(){var x=this;var y=x.get("delimChar");var A={previous:"",query:x.inputNode.get("value")};if(y){A=x._extractQuery(x.inputNode.get("value"));}x.fire("selectionEnforce",A.query);},_createDataSource:function(){var A=this;var AC=A.get("dataSource");var AA=AC;var AB=A.get("dataSourceType");if(!(AC instanceof M.DataSource.Local)){if(!AB){AB="Local";if(O(AA)){AB="Function";}else{if(J(AA)){AB="IO";}}}AC=new M.DataSource[AB]({source:AA});}AC.on("error",A.handleResponse,A);AC.after("response",A.handleResponse,A);AB=AC.name;if(AB=="dataSourceLocal"){A.set("applyLocalFilter",true);}A.set("dataSource",AC);A.set("dataSource",AB);A.dataSource=AC;var z=A.get("schema");if(z){if(z.fn){A.dataSource.plug(z);}else{var x=A.get("schemaType");var y={array:M.Plugin.DataSourceArraySchema,json:M.Plugin.DataSourceJSONSchema,text:M.Plugin.DataSourceTextSchema,xml:M.Plugin.DataSourceXMLSchema};x=x.toLowerCase()||"array";A.dataSource.plug({fn:y[x],cfg:{schema:z}});}}A.set("schema",z);},_enableIntervalDetection:function(){var A=this;var x=A.get("queryInterval");if(!A._queryIntervalId&&x){A._queryInterval=setInterval(M.bind(A._onInterval,A),x);}},_extractQuery:function(AA){var AE=this;var AC=AE.get("delimChar");var A=-1;var y=AC.length-1;var AD,AB,z;for(;y>=0;y--){AD=AA.lastIndexOf(AC[y]);if(AD>A){A=AD;}}if(AC[y]==" "){for(var x=AC.length-1;x>=0;x--){if(AA[A-1]==AC[x]){A--;break;}}}if(A>-1){AB=A+1;while(AA.charAt(AB)==" "){AB+=1;}z=AA.substring(0,AB);AA=AA.substring(AB);}else{z="";}return{previous:z,query:AA};},_focus:function(){var A=this;setTimeout(function(){A.inputNode.focus();},0);},_isIgnoreKey:function(x){var A=this;if((x==m)||(x==d)||(x==K)||(x==E)||(x>=F&&x<=P)||(x==e)||(x>=I&&x<=L)||(x>=Y&&x<=X)||(x>=g&&x<=u)||(x==G)){return true;}return false;},_jumpSelection:function(){var A=this;if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}},_moveSelection:function(AJ){var AG=this;if(AG.overlay.get("visible")){var AK=AG._elCurListItem;var x=-1;if(AK){x=Number(AK.getAttribute("data-listItemIndex"));}var y=x-1;if(AJ==X){y=x+1;
}if(y==-1){y=AG._displayedItems-1;}if(y>=AG._displayedItems){y=0;}if(y<-2){return;}if(AK){AG._toggleHighlight(AK,"from");AG.fire("itemArrowFrom",AK);}if(y==-1){if(AG.get("delimChar")){AG.inputNode.set("value",AG._pastSelections+AG._currentQuery);}else{AG.inputNode.set("value",AG._currentQuery);}return;}if(y==-2){AG._toggleContainer(false);return;}var AC=AG.resultList.get("childNodes").item(y);var AA=AG.overlay.get(b);var AE=AA.getStyle("overflow");var AH=AA.getStyle("overflowY");var z=(AE=="auto")||(AE=="scroll")||(AH=="auto")||(AH=="scroll");if(z&&(y>-1)&&(y<AG._displayedItems)){var A=-1;var AL=AC.get("offsetTop");var AB=AL+AC.get("offsetHeight");var AF=AA.get("offsetHeight");var AD=AA.get("scrollTop");var AI=AF+AD;if(AJ==X){if(AB>AI){A=(AB-AF);}else{if(AB<AD){A=AL;}}}else{if(AL<AF){A=AL;}else{if(AL>AI){A=(AB-AF);}}}if(A>-1){AA.set("scrollTop",A);}}AG._toggleHighlight(AC,"to");AG.fire("itemArrowTo",AC);if(AG.get("typeAhead")){AG._updateValue(AC);}}},_onButtonMouseDown:function(x){var A=this;x.halt();A._focus();A._sendQuery(A.inputNode.get("value")+"*");},_onContainerClick:function(y){var A=this;var z=y.target;var x=z.get("nodeName").toLowerCase();y.halt();while(z&&(x!="table")){switch(x){case"body":return;case"li":A._toggleHighlight(z,"to");A._selectItem(z);return;default:break;}z=z.get("parentNode");if(z){x.get("nodeName").toLowerCase();}}},_onContainerMouseout:function(y){var A=this;var z=y.target;var x=z.get("nodeName").toLowerCase();while(z&&(x!="table")){switch(x){case"body":return;case"li":A._toggleHighlight(z,"from");A.fire("itemMouseOut",z);break;case"ul":A._toggleHighlight(A._elCurListItem,"to");break;case"div":if(z.hasClass(B)){A._overContainer=false;return;}break;default:break;}z=z.get("parentNode");if(z){x=z.get("nodeName").toLowerCase();}}},_onContainerMouseover:function(y){var A=this;var z=y.target;var x=z.get("nodeName").toLowerCase();while(z&&(x!="table")){switch(x){case"body":return;case"li":A._toggleHighlight(z,"to");A.fire("itemMouseOut",z);break;case"div":if(z.hasClass(B)){A._overContainer=true;return;}break;default:break;}z=z.get("parentNode");if(z){x=z.get("nodeName").toLowerCase();}}},_onContainerScroll:function(x){var A=this;A._focus();},_onInterval:function(){var A=this;var y=A.inputNode.get("value");var x=A._lastValue;if(y!=x){A._lastValue=y;A._sendQuery(y);}},_onTextboxBlur:function(z){var A=this;if(!A._overContainer||(A._keyCode==m)){if(!A._itemSelected){var y=A._textMatchesOption();var x=A.overlay.get("visible");if(!x||(x&&n(y))){if(A.get("forceSelection")){A._clearSelection();}else{A.fire("unmatchedItemSelect",A._currentQuery);}}else{if(A.get("forceSelection")){A._selectItem(y);}}}A._clearInterval();A.blur();if(A._initInputValue!==A.inputNode.get("value")){A.fire("textboxChange");}A.fire("textboxBlur");A._toggleContainer(false);}else{A._focus();}},_onTextboxFocus:function(x){var A=this;if(!A.get("focused")){A.inputNode.setAttribute("autocomplete","off");A.focus();A._initInputValue=A.inputNode.get("value");A.fire("textboxFocus");}},_onTextboxKeyDown:function(x){var A=this;var y=x.keyCode;if(A._typeAheadDelayId!=-1){clearTimeout(A._typeAheadDelayId);}switch(y){case m:if(A._elCurListItem){if(A.get("delimChar")&&A._keyCode!=y){if(A.overlay.get("visible")){x.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case d:if(A._elCurListItem){if(A._keyCode!=y){if(A.overlay.get("visible")){x.halt();}}A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}break;case e:A._toggleContainer(false);return;case l:if(A.overlay.get("visible")){x.halt();A._moveSelection(y);}break;case W:A._jumpSelection();break;case X:if(A.overlay.get("visible")){x.halt();A._moveSelection(y);}break;default:A._itemSelected=false;A._toggleHighlight(A._elCurListItem,"from");A.fire("textboxKey",y);break;}if(y==F){A._enableIntervalDetection();}A._keyCode=y;},_onTextboxKeyPress:function(x){var A=this;var y=x.keyCode;switch(y){case m:if(A.overlay.get("visible")){if(A.get("delimChar")){x.halt();}if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;case 13:if(A.overlay.get("visible")){x.halt();if(A._elCurListItem){A._selectItem(A._elCurListItem);}else{A._toggleContainer(false);}}break;default:break;}if(y==G){A._enableIntervalDetection();}},_onTextboxKeyUp:function(y){var A=this;var x=A.inputNode;var z=x.get("value");var AA=y.keyCode;if(A._isIgnoreKey(AA)){return;}if(A._delayId!=-1){clearTimeout(A._delayId);}A._delayId=setTimeout(function(){A._sendQuery(z);},A.get("queryDelay"));},_populateList:function(A){var AH=this;if(AH._typeAheadDelayId!=-1){clearTimeout(AH._typeAheadDelayId);}var AC=A.request;var AA=A.response;var AK=A.callback;var z=(AC=="*");if(AK&&AK.argument&&AK.argument.query){A.request=AC=AK.argument.query;}var AF=AH.doBeforeLoadData(A);if(AF&&!A.error){AH.fire("dataReturn",A);var AE=AH.get("focused");if(z||AE||AE===null){var AD=decodeURIComponent(AC);AH._currentQuery=AD;AH._itemSelected=false;var y=A.response.results;var AJ=Math.min(y.length,AH.get("maxResultsDisplayed"));var AB=AH.get("schema.resultFields");var AI=AH.get("matchKey");if(!AI&&AB){AI=AB[0];}else{AI=AI||0;}if(AJ>0){var AG=AH.resultList.get("childNodes");AG.each(function(AP,AO,AN){if(AO<AJ){var AM=y[AO];var AL="";if(J(AM)){AL=AM;}else{if(V(AM)){AL=AM[0];}else{AL=AM[AI];}}AP._resultMatch=AL;AP._resultData=AM;AP.html(AH.formatResult(AM,AD,AL));AP.removeClass("aui-helper-hidden");}else{AP.addClass("aui-helper-hidden");}});AH._displayedItems=AJ;AH.fire("containerPopulate",AC,y);if(AC!="*"&&AH.get("autoHighlight")){var x=AH.resultList.get("firstChild");AH._toggleHighlight(x,"to");AH.fire("itemArrowTo",x);AH._typeAhead(x,AC);}else{AH._toggleHighlight(AH._elCurListItem,"from");}AF=AH.doBeforeExpandContainer(AC,y);AH._toggleContainer(AF);}else{AH._toggleContainer(false);}return;}}else{AH.fire("dataError",AC);}},_realignContainer:function(x){var A=this;var y=A._overlayAlign;A.overlay._uiSetAlign(y.node,y.points);},_renderInput:function(){var x=this;var y=x.get(b);
var z=x.get("input");var AB={field:{labelText:false},icons:[{icon:"circle-triangle-b",id:"trigger",handler:{fn:x._onButtonMouseDown,context:x}}]};var AA=null;var A=null;if(z){z=M.get(z);AB.field.node=z;AA=z.next();A=z.get("parentNode");}var AC=new M.Combobox(AB).render(y);if(A){var AD=AC.get("boundingBox");A.insertBefore(AD,AA);}x.inputNode=AC.get("node");x.button=AC.icons.item("trigger");x.set("uniqueName",M.stamp(x.inputNode));},_renderListElements:function(){var A=this;var z=A.get("maxResultsDisplayed");var x=A.resultList;var y=[];while(z--){y[z]='<li class="aui-helper-hidden '+H+'" data-listItemIndex="'+z+'"></li>';}x.html(y.join(""));},_renderOverlay:function(){var A=this;var z=A._overlayAlign;z.node=A.inputNode;var y=new M.OverlayBase({align:z,bodyContent:"<ul></ul>",visible:false,width:A.inputNode.get("offsetWidth")});var x=y.get(b);y.get(s).addClass(B);x.addClass(U);y.render(document.body);y.addTarget(A);A.overlay=y;A.resultList=x.query("ul");A.resultList.addClass(o);A._renderListElements();},_selectItem:function(x){var A=this;A._itemSelected=true;A._updateValue(x);A._pastSelections=A.inputNode.get("value");A._clearInterval();A.fire("itemSelect",x,x._resultData);A._toggleContainer(false);},_selectText:function(AA,AC,y){var A=this;var x=M.Node.getDOMNode(AA);var AB=AA.get("value");if(x.setSelectionRange){x.setSelectionRange(AC,y);}else{if(x.createTextRange){var z=x.createTextRange();z.moveStart("character",AC);z.moveEnd("character",y-AB.length);z.select();}else{x.select();}}},_sendQuery:function(AB){var x=this;if(x.get("disabled")){x._toggleContainer(false);return;}var z=x.get("delimChar");var y=x.get("minQueryLength");if(z){var A=x._extractQuery(AB);AB=A.query;x._pastSelections=A.previous;}if((AB&&(AB.length<y))||(!AB&&y>0)){if(x._delayId!=-1){clearTimeout(x._delayId);}x._toggleContainer(false);return;}AB=encodeURIComponent(AB);x._delayId=-1;if(x.get("applyLocalFilter")){x.dataSource.on("response",x.filterResults,x);}var AA=x.generateRequest(AB);x.fire("dataRequest",AB,AA);x.dataSource.sendRequest(AA);},_textMatchesOption:function(){var A=this;var x=null;var AB=A._displayedItems;var AC=A.resultList.get("childNodes");for(var z=0;z<AB.length;z++){var AA=AC.item(z);var y=(""+AA._resultMatch).toLowerCase();if(y==A._currentQuery.toLowerCase()){x=AA;break;}}return x;},_toggleContainer:function(x){var A=this;var y=A.overlay;if(A.get("alwaysShowContainer")&&y.get("visible")){return;}if(!x){A._toggleHighlight(A._elCurListItem,"from");A._displayedItems=0;A._currentQuery=null;}if(x){y.show();A.fire("containerExpand");}else{y.hide();A.fire("containerCollapse");}},_toggleHighlight:function(x,y){var A=this;if(x){if(A._elCurListItem){A._elCurListItem.removeClass(C);A._elCurListItem=null;}if(y=="to"){x.addClass(C);A._elCurListItem=x;}}},_typeAhead:function(x,y){var A=this;if(!A.get("typeAhead")||A._keyCode==Q){return;}var z=M.Node.getDOMNode(A.inputNode);if(z.setSelectionRange||z.createTextRange){A._typeAheadDelayId=setTimeout(function(){var AC=z.value;var AD=AC.length;A._updateValue(x);var AA=z.value.length;A._selectText(A.inputNode,AD,AA);var AB=z.value.substr(AD,AA);A.fire("typeAhead",y,AB);},A.get("typeAheadDelay"));}},_updateValue:function(AB){var x=this;if(!x.get("suppressInputUpdate")){var AA=x.inputNode;var A=AB._resultMatch;var z=x.get("delimChar");z=(z&&z[0])||z;var AC="";if(z){AC=x._pastSelections;AC+=A+z;if(z!=" "){AC+=" ";}}else{AC=A;}AA.set("value",AC);if(AA.get("type")=="textarea"){AA.set("scrollTop",AA.get("scrollHeight"));}var y=AC.length;x._selectText(AA,y,y);x._elCurListItem=AB;}},_currentQuery:null,_delayId:-1,_displayedItems:0,_elCurListItem:null,_initInputValue:null,_itemSelected:false,_keyCode:null,_lastValue:null,_overContainer:false,_pastSelections:"",_typeAheadDelayId:-1});M.AutoComplete=N;},"1.0pr",{requires:["aui-base","aui-overlay-base","datasource","dataschema","aui-form-combobox"],skinnable:true});